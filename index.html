<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        td {
            border: 1px solid black;
            text-align: center;
        }
    </style>
</head>

<body>
    <!-- <button onclick="getfu()">132</button> -->
    <table class="table">
        <tr>
            <td>星期一</td>
            <td>星期二</td>
            <td>星期三</td>
            <td>星期四</td>
            <td>星期五</td>
            <td>星期六</td>
            <td>星期天</td>
        </tr>
    </table>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- <script src="./ax.js"></script> -->
    <script>
        const tab = document.querySelector(".table");
        axios({
            url: 'http://localhost:3038/getkcb?username=202105010005&password=gsh6857810',
            method: 'POST',
        }).then(result => {
            let xuanran = new Array(8);
            let ic = 0; // 第几届
            for (let i = 0; i < xuanran.length; i++) {
                xuanran[i] = new Array(7);
            }
            result.data.forEach((element, index) => {
                // 判断是否切换下一行
                if (index !== 0 && result.data[index - 1].xingqi >= element.xingqi) {
                    ic++;
                }
                // console.log(element, index);
                xuanran[ic][element.xingqi - 1] = element
            });
            // console.log(xuanran);
            let ruttab = ''
            let sum;
            for (let a = 0; a < xuanran.length; a++) {
                ruttab += `<tr>`
                sum = 0;
                for (let b = 0; b < xuanran[a].length; b++) {
                    // 合并两节课合上
                    let ifhs = true
                    // 排除最后一排
                    if (a < xuanran[a].length && xuanran[a][b]) {
                        try {
                            if (xuanran[a][b].id == xuanran[a + 1][b-sum].id) {
                                ifhs = false
                                xuanran[a + 1].splice(b-sum, 1)
                                sum++ ;
                                // 推理过程  
                                // [1][0] => [1][0] d d= 0 sum = 1 
                                // [1][2] => [1][1] d d=1 sum = 2
                                // [1][3] => [1][2] => [1][1] d sum = 3
                                // b1 - sum = b


                                // [3][0] => [3][0] sum = 1
                                // [3][1] => [3][0] sum = 2
                                // [3][2] => [3][1] => [3][0] sum = 3
                                // [3][3] => [3][2] => [3][1] => [3][0] sum = 4

                                console.log(xuanran[a + 1][b].jxbmc, `[${a + 1}][${b}]`,`sum=${sum}`);
                               
                            }
                        } catch (error) {

                        }
                      
                    }
                    ruttab += `<td rowspan="${ifhs ? 1 : 2}">${xuanran[a][b] ? xuanran[a][b].jxbmc : ''}</td>`
                }
                ruttab += `</tr>`
            }
            tab.innerHTML += ruttab
            console.log(xuanran);

        })
    </script>
</body>

</html>